{% load static %}
{% load widget_tweaks %}
{% load socialaccount %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="description" content="Create your free VisMatrix.Space account - Track progress with friends">
  <meta name="theme-color" content="#1d4ed8">
  <title>Create Account - VisMatrix.Space</title>

  <!-- App Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'branding/vismatrixicon.png' %}">

  <!-- Tailwind + DaisyUI + Bootstrap Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    /* Signup page specific styles - matches base.html design system */
    .signup-hero {
      background: linear-gradient(135deg, rgb(248 250 252 / 0.9) 0%, rgb(241 245 249 / 0.7) 100%);
      backdrop-filter: blur(20px);
    }
    
    .signup-card {
      background: rgb(255 255 255 / 0.98);
      border: 1px solid rgb(226 232 240 / 0.8);
      box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.1);
    }
    
    .signup-header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    }
    
    /* Animations matching base.html */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
    }
    
    /* Enhanced focus states */
    .input:focus {
      border-color: rgb(29 78 216);
      box-shadow: 0 0 0 3px rgb(29 78 216 / 0.25);
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 lg:p-8 signup-hero">
  

  <main id="main-signup" class="w-full max-w-md lg:max-w-lg signup-card rounded-3xl overflow-hidden animate-slideUp max-h-[90vh] overflow-y-auto" role="main" aria-labelledby="signup-title">
    
    <!-- Header -->
    <div class="signup-header text-white p-8 lg:p-10 text-center relative sticky top-0 z-20 bg-slate-900/95 backdrop-blur-sm border-b border-white/20">
      <div class="w-20 h-20 lg:w-24 lg:h-24 mx-auto mb-8 bg-white/20 rounded-2xl flex items-center justify-center shadow-2xl ring-2 ring-white/30">
        <i class="bi bi-person-plus-fill text-3xl lg:text-4xl" aria-hidden="true"></i>
      </div>
      <h1 id="signup-title" class="text-3xl lg:text-4xl font-black tracking-tight mb-4">
        Create Account
      </h1>
      <p class="text-xl font-semibold text-slate-200 mb-6 opacity-90 leading-relaxed max-w-sm mx-auto">
        Join VisMatrix.Space and start tracking your progress today
      </p>
      <div class="inline-flex items-center gap-2 bg-emerald-400/90 text-emerald-900 px-6 py-3 rounded-2xl font-bold text-base lg:text-lg shadow-lg border border-emerald-300/50">
        <i class="bi bi-check-circle-fill" aria-hidden="true"></i>
        <span>Free Forever Plan</span>
      </div>
    </div>

    <div class="p-8 lg:p-10 space-y-6 pb-12 lg:pb-16">
      <!-- Feature highlight -->
      <div class="alert alert-success shadow-lg border-l-4">
        <i class="bi bi-infinity flex-shrink-0"></i>
        <div>
          <h3 class="font-bold text-lg">Unlimited Everything</h3>
          <div class="text-sm">Track unlimited tasks, logs, categories with full AI insights</div>
        </div>
      </div>

      <!-- Google Sign Up Option -->
      {% get_providers as socialaccount_providers %}
      {% if socialaccount_providers %}
      <div class="card-compact p-0">
        <a href="{% provider_login_url 'google' process='connect' %}"
           class="btn btn-outline w-full h-14 gap-3 normal-case border-slate-200 hover:border-slate-300 hover:bg-slate-50 shadow-sm hover:shadow-md transition-all duration-200 text-base font-semibold text-lg"
           role="button" aria-label="Continue with Google to create account">
          <i class="bi bi-google text-xl" aria-hidden="true"></i>
          <span>Continue with Google</span>
        </a>
      </div>

      <div class="divider text-sm text-slate-500 before:bg-slate-200 after:bg-slate-200">or create account with email</div>
      {% endif %}

      <!-- Error alerts -->
      {% if form.non_field_errors %}
      <div class="alert alert-error shadow-lg">
        <i class="bi bi-exclamation-triangle-fill flex-shrink-0"></i>
        <span>{% for error in form.non_field_errors %}{{ error }}{% endfor %}</span>
      </div>
      {% endif %}

      <!-- Registration Form -->
      <form method="post" class="space-y-6" novalidate role="form">
        {% csrf_token %}
        
        <!-- Username Field -->
        <div class="form-control w-full">
          <label for="{{ form.username.id_for_label }}" class="label">
            <span class="label-text font-semibold text-base">Username 
              <span class="text-slate-500 font-normal text-sm">(unique, 3-30 characters)</span>
            </span>
          </label>
          {% render_field form.username class="input input-bordered w-full h-14 text-base lg:input-lg" placeholder="Choose a unique username" autocomplete="username" %}
          {% if form.username.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ form.username.errors|first }}</span>
          </label>
          {% endif %}
        </div>

        <!-- Email Field -->
        <div class="form-control w-full">
          <label for="{{ form.email.id_for_label }}" class="label">
            <span class="label-text font-semibold text-base">Email Address</span>
          </label>
          {% render_field form.email class="input input-bordered w-full h-14 text-base lg:input-lg" placeholder="your.email@example.com" autocomplete="email" %}
          {% if form.email.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ form.email.errors|first }}</span>
          </label>
          {% endif %}
        </div>

        <!-- Password Field 1 -->
        <div class="form-control w-full">
          <label for="{{ form.password1.id_for_label }}" class="label">
            <span class="label-text font-semibold text-base">Password 
              <span class="text-slate-500 font-normal text-sm">(8+ characters)</span>
            </span>
          </label>
          {% render_field form.password1 class="input input-bordered w-full h-14 text-base lg:input-lg" placeholder="Create a strong password" autocomplete="new-password" %}
          {% if form.password1.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ form.password1.errors|first }}</span>
          </label>
          {% endif %}
        </div>

        <!-- Password Field 2 -->
        <div class="form-control w-full">
          <label for="{{ form.password2.id_for_label }}" class="label">
            <span class="label-text font-semibold text-base">Confirm Password</span>
          </label>
          {% render_field form.password2 class="input input-bordered w-full h-14 text-base lg:input-lg" placeholder="Confirm your password" autocomplete="new-password" %}
          {% if form.password2.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ form.password2.errors|first }}</span>
          </label>
          {% endif %}
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary w-full h-14 text-lg font-bold shadow-lg hover:shadow-xl gap-3 lg:btn-lg">
          <i class="bi bi-check-circle-fill" aria-hidden="true"></i>
          <span>Create My Account</span>
        </button>
      </form>

      <!-- Login link -->
      <div class="text-center pt-8 border-t border-slate-200 pb-12">
        <p class="text-sm text-slate-600">
          Already have an account? 
          <a href="{% url 'account_login' %}" class="link link-hover font-bold text-primary">Sign in instead</a>
        </p>
      </div>
    </div>
  </main>

  <script>
    // Enhanced accessibility and UX
    document.addEventListener('DOMContentLoaded', () => {
      // Auto-focus first field
      const firstField = document.querySelector('input[type="text"]');
      if (firstField) firstField.focus();
      
      // Real-time password matching validation
      const password1 = document.querySelector('input[name="password1"]');
      const password2 = document.querySelector('input[name="password2"]');
      
      if (password1 && password2) {
        const validatePasswords = () => {
          if (password1.value && password2.value && password1.value !== password2.value) {
            password2.setCustomValidity('Passwords do not match');
            password2.classList.add('border-error');
          } else {
            password2.setCustomValidity('');
            password2.classList.remove('border-error');
          }
        };
        
        password1.addEventListener('input', validatePasswords);
        password2.addEventListener('input', validatePasswords);
      }
      
      // Escape goes back to login
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          window.location.href = "{% url 'account_login' %}";
        }
      });
    });
  </script>
</body>
</html>
