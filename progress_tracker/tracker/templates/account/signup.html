{% load static %}
{% load widget_tweaks %}
{% load socialaccount %}

<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="description" content="Create your free VisMatrix.Space account — AI-powered personal achievement. Track progress, stay accountable, and achieve goals with agentic AI.">
  <meta name="theme-color" content="#1d4ed8">
  <title>Create Account — VisMatrix.Space</title>

  <!-- App Icons (browser tab / PWA) -->
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'branding/vismatrixicon.png' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'branding/vismatrixicon.png' %}">
  <meta name="application-name" content="VisMatrix">
  <meta name="apple-mobile-web-app-title" content="VisMatrix">

  <!-- Tailwind + DaisyUI + Bootstrap Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <!-- Apply theme BEFORE paint (prevents flash + syncs with dashboard) -->
  <script>
    (function () {
      const STORAGE_KEY = 'vm_theme';
      const saved = localStorage.getItem(STORAGE_KEY);
      const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = (saved === 'light' || saved === 'dark') ? saved : (systemPrefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <style>
    :root{
      --border: rgba(226,232,240,.9);
      --shadow: 0 1px 2px rgb(15 23 42 / 0.06), 0 20px 40px rgb(15 23 42 / 0.10);
      --focus: 0 0 0 3px rgb(29 78 216 / 0.25);
    }
    [data-theme="dark"] {
      --border: rgba(71,85,105,.9);
      --shadow: 0 1px 2px rgb(0 0 0 / 0.2), 0 20px 40px rgb(0 0 0 / 0.3);
      --focus: 0 0 0 3px rgb(96 165 250 / 0.4);
    }

    body{
      background:
        radial-gradient(1000px 600px at 20% 12%, rgba(29,78,216,.14) 0%, rgba(29,78,216,0) 60%),
        radial-gradient(800px 500px at 90% 10%, rgba(16,185,129,.12) 0%, rgba(16,185,129,0) 55%),
        radial-gradient(900px 600px at 55% 95%, rgba(99,102,241,.10) 0%, rgba(99,102,241,0) 60%),
        #f8fafc;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-tap-highlight-color: transparent;
      transition: background-color 0.3s ease;
    }
    [data-theme="dark"] body{
      background:
        radial-gradient(1000px 600px at 20% 12%, rgba(59,130,246,.18) 0%, rgba(59,130,246,0) 60%),
        radial-gradient(800px 500px at 90% 10%, rgba(16,185,129,.15) 0%, rgba(16,185,129,0) 55%),
        radial-gradient(900px 600px at 55% 95%, rgba(139,92,246,.12) 0%, rgba(139,92,246,0) 60%),
        #0f172a;
    }

    :focus-visible { outline: none; box-shadow: var(--focus); border-radius: 12px; }

    .glass{
      background: rgba(255,255,255,.92);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    [data-theme="dark"] .glass{
      background: rgba(30,41,59,.92);
    }

    .solid{
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    [data-theme="dark"] .solid{
      background: #1e293b;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:.5rem .75rem;
      border-radius: 9999px;
      font-weight: 800;
      font-size: .82rem;
      border: 1px solid rgba(29,78,216,.18);
      background: rgba(29,78,216,.08);
      color: #0f172a;
      white-space: nowrap;
      transition: all 0.3s ease;
    }
    [data-theme="dark"] .tag{
      border: 1px solid rgba(96,165,250,.3);
      background: rgba(96,165,250,.15);
      color: #e2e8f0;
    }

    .brandmark{
      width: 44px; height: 44px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(29,78,216,.10);
      border: 1px solid rgba(29,78,216,.18);
      flex-shrink: 0;
      transition: all 0.3s ease;
    }
    [data-theme="dark"] .brandmark{
      background: rgba(96,165,250,.15);
      border: 1px solid rgba(96,165,250,.3);
    }

    .feature{
      border: 1px solid rgba(226,232,240,.9);
      border-radius: 16px;
      background: rgba(255,255,255,.86);
      transition: all 0.3s ease;
    }
    [data-theme="dark"] .feature{
      border: 1px solid rgba(71,85,105,.9);
      background: rgba(30,41,59,.86);
    }

    .input:focus { border-color: rgb(29 78 216); box-shadow: var(--focus); }

    .soft-divider{
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(226,232,240,.9), transparent);
    }

    .sticky-panel{
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(226,232,240,.9);
    }

    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; animation: none !important; scroll-behavior: auto !important; }
    }
  </style>
</head>

<body>
  <a href="#signup" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 bg-slate-900 text-white px-3 py-2 rounded-xl">
    Skip to sign up
  </a>

  <!-- Top bar (matches landing/login styling) -->
  <header class="sticky top-0 z-40 bg-white/70 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between gap-3">
      <a href="{% url 'account_login' %}" class="flex items-center gap-3 hover:opacity-90 transition">
        <img
          src="{% static 'branding/vismatrixicon.png' %}"
          alt="VisMatrix icon"
          class="w-9 h-9 rounded-xl ring-1 ring-slate-200 bg-white p-1 object-contain"
          loading="eager"
        />
        <div class="leading-tight">
          <div class="text-base sm:text-lg font-black tracking-tight">
            VisMatrix<span class="text-primary">.space</span>
          </div>
          <div class="text-xs text-slate-600 hidden sm:block">AI-powered personal achievement</div>
        </div>
      </a>

      <div class="flex items-center gap-2">
        <span class="tag hidden sm:inline-flex">
          <i class="bi bi-stars" aria-hidden="true"></i>
          Agentic AI arriving March 2026
        </span>
        <button id="themeToggle" class="btn btn-ghost btn-sm btn-circle" aria-label="Toggle theme">
          <i class="bi bi-moon-stars text-lg" id="themeIcon" aria-hidden="true"></i>
        </button>
        <a href="{% url 'about' %}" class="btn btn-ghost btn-sm">About</a>
        <a href="{% url 'account_login' %}" class="btn btn-primary btn-sm gap-2">
          <i class="bi bi-box-arrow-in-right" aria-hidden="true"></i>
          Sign in
        </a>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-10 space-y-6">

    <!-- HERO -->
    <section class="glass p-6 sm:p-10">
      <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">

        <div class="min-w-0">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm flex items-center justify-center">
              <img src="{% static 'branding/vismatrixicon.png' %}" alt="VisMatrix icon" class="w-8 h-8 sm:w-9 sm:h-9 object-contain">
            </div>
            <div class="leading-tight">
              <div class="text-sm font-extrabold text-slate-900">Create your account</div>
              <div class="text-xs text-slate-600">Start building momentum today</div>
            </div>
            <span class="tag lg:hidden ml-auto">
              <i class="bi bi-stars" aria-hidden="true"></i>
              March 2026
            </span>
          </div>

          <h1 class="text-3xl sm:text-5xl font-black tracking-tight leading-tight">
            Join VisMatrix<span class="text-primary">.space</span> — make progress measurable.
          </h1>

          <p class="mt-4 text-base sm:text-lg text-slate-600 leading-relaxed max-w-3xl">
            Track goals, log effort, and learn from your trends. Friends keep you accountable — and AI agents (coming soon) help you execute step-by-step.
          </p>

          <div class="mt-5 flex flex-col sm:flex-row gap-3">
            <a href="#signup" class="btn btn-primary gap-2">
              <i class="bi bi-person-plus" aria-hidden="true"></i>
              Create free account
            </a>
            <a href="{% url 'about' %}" class="btn btn-outline gap-2">
              <i class="bi bi-info-circle" aria-hidden="true"></i>
              Learn more
            </a>
            <span class="tag hidden lg:inline-flex">
              <i class="bi bi-stars" aria-hidden="true"></i>
              Agentic AI arriving March 2026
            </span>
          </div>
        </div>

        <!-- Right-side proof panel -->
        <div class="solid p-5 sm:p-6 w-full lg:max-w-sm">
          <div class="flex items-start gap-3">
            <div class="brandmark">
              <i class="bi bi-infinity text-primary text-xl" aria-hidden="true"></i>
            </div>
            <div>
              <div class="font-extrabold text-slate-900">Free to start</div>
              <p class="text-sm text-slate-600 mt-1">
                Create unlimited tasks and logs. Keep things simple, consistent, and visible.
              </p>
            </div>
          </div>

          <div class="mt-4 space-y-2 text-sm">
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-success mt-0.5" aria-hidden="true"></i>
              <span>Unlimited tasks, logs & categories</span>
            </div>
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-success mt-0.5" aria-hidden="true"></i>
              <span>Progress analytics and trends</span>
            </div>
            <div class="flex items-start gap-2">
              <i class="bi bi-check-circle text-success mt-0.5" aria-hidden="true"></i>
              <span>Friends & accountability features</span>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 soft-divider"></div>

      <div class="mt-6 grid sm:grid-cols-3 gap-3">
        <div class="feature p-4">
          <div class="flex items-center gap-3">
            <div class="brandmark"><i class="bi bi-heart-pulse text-primary text-xl" aria-hidden="true"></i></div>
            <div>
              <div class="font-extrabold">Health goals</div>
              <div class="text-sm text-slate-600">Build habits and track outcomes.</div>
            </div>
          </div>
        </div>
        <div class="feature p-4">
          <div class="flex items-center gap-3">
            <div class="brandmark"><i class="bi bi-book text-primary text-xl" aria-hidden="true"></i></div>
            <div>
              <div class="font-extrabold">Study goals</div>
              <div class="text-sm text-slate-600">Consistency-driven learning.</div>
            </div>
          </div>
        </div>
        <div class="feature p-4">
          <div class="flex items-center gap-3">
            <div class="brandmark"><i class="bi bi-briefcase text-primary text-xl" aria-hidden="true"></i></div>
            <div>
              <div class="font-extrabold">Work goals</div>
              <div class="text-sm text-slate-600">Execution and measurable wins.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SIGN UP -->
    <section id="signup" class="solid p-6 sm:p-8">
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm flex items-center justify-center">
            <img src="{% static 'branding/vismatrixicon.png' %}" alt="VisMatrix icon" class="w-8 h-8 object-contain">
          </div>
          <div>
            <h2 class="text-2xl sm:text-3xl font-black tracking-tight">Create account</h2>
            <p class="text-sm text-slate-600">It only takes a minute.</p>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <a href="{% url 'account_login' %}" class="btn btn-ghost btn-sm">Already have an account?</a>
        </div>
      </div>

      {% get_providers as socialaccount_providers %}
      {% if socialaccount_providers %}
      <div class="mt-6">
        <a href="{% provider_login_url 'google' %}"
           class="btn btn-outline w-full gap-3 normal-case h-12 border-slate-200 hover:border-slate-300 hover:bg-slate-50 shadow-sm hover:shadow-md transition-all duration-200 text-base font-semibold"
           role="button" aria-label="Continue with Google to create account">
          <i class="bi bi-google text-lg" aria-hidden="true"></i>
          <span>Continue with Google</span>
        </a>
        <div class="divider text-sm text-slate-500 before:bg-slate-200 after:bg-slate-200 mt-5">
          or create account with email
        </div>
      </div>
      {% endif %}

      {% if form.non_field_errors %}
      <div class="alert alert-error shadow-sm mt-4">
        <i class="bi bi-exclamation-triangle-fill flex-shrink-0" aria-hidden="true"></i>
        <span>{% for error in form.non_field_errors %}{{ error }}{% endfor %}</span>
      </div>
      {% endif %}

      <form method="post" class="mt-5 space-y-5" novalidate role="form">
        {% csrf_token %}

        <div class="grid lg:grid-cols-2 gap-4">
          <div class="form-control w-full">
            <label for="{{ form.username.id_for_label }}" class="label">
              <span class="label-text font-semibold">Username</span>
            </label>
            {% render_field form.username class="input input-bordered w-full h-12 text-base" placeholder="Choose a username" autocomplete="username" %}
            {% if form.username.errors %}
            <label class="label">
              <span class="label-text-alt text-error">{{ form.username.errors|first }}</span>
            </label>
            {% endif %}
          </div>

          <div class="form-control w-full">
            <label for="{{ form.email.id_for_label }}" class="label">
              <span class="label-text font-semibold">Email</span>
            </label>
            {% render_field form.email class="input input-bordered w-full h-12 text-base" placeholder="you@example.com" autocomplete="email" %}
            {% if form.email.errors %}
            <label class="label">
              <span class="label-text-alt text-error">{{ form.email.errors|first }}</span>
            </label>
            {% endif %}
          </div>

          <div class="form-control w-full">
            <label for="{{ form.password1.id_for_label }}" class="label">
              <span class="label-text font-semibold">Password</span>
            </label>
            {% render_field form.password1 class="input input-bordered w-full h-12 text-base" placeholder="Create a password" autocomplete="new-password" %}
            {% if form.password1.errors %}
            <label class="label">
              <span class="label-text-alt text-error">{{ form.password1.errors|first }}</span>
            </label>
            {% endif %}
          </div>

          <div class="form-control w-full">
            <label for="{{ form.password2.id_for_label }}" class="label">
              <span class="label-text font-semibold">Confirm password</span>
            </label>
            {% render_field form.password2 class="input input-bordered w-full h-12 text-base" placeholder="Confirm your password" autocomplete="new-password" %}
            {% if form.password2.errors %}
            <label class="label">
              <span class="label-text-alt text-error">{{ form.password2.errors|first }}</span>
            </label>
            {% endif %}
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-full h-12 text-base font-extrabold shadow-lg hover:shadow-xl gap-2">
          <i class="bi bi-check-circle-fill" aria-hidden="true"></i>
          <span>Create my account</span>
        </button>

        <p class="text-xs text-slate-500 leading-relaxed">
          By creating an account you agree to behave respectfully and keep your content appropriate. (You can add your formal terms later.)
        </p>
      </form>

      <div class="mt-6 pt-6 border-t border-slate-200 text-center space-y-2">
        <p class="text-sm text-slate-600">
          Already have an account?
          <a href="{% url 'account_login' %}" class="link link-hover font-extrabold text-primary">Sign in</a>
        </p>
        <p class="text-xs text-slate-500">
          Built for clarity, momentum, and accountability.
        </p>
      </div>
    </section>

  </main>

  <footer class="border-t border-slate-200 bg-white/60 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
      <div class="text-sm text-slate-600">
        © {% now "Y" %} VisMatrix.Space · AI-powered personal achievement
      </div>
      <div class="flex flex-wrap gap-2">
        <a href="{% url 'about' %}" class="btn btn-ghost btn-sm">About</a>
        <a href="{% url 'account_login' %}" class="btn btn-ghost btn-sm">Sign in</a>
      </div>
    </div>
  </footer>

  <script>
    // Theme toggle functionality (synced with dashboard)
    (function() {
      const STORAGE_KEY = 'vm_theme';
      const htmlEl = document.documentElement;
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');

      const updateIcon = (theme) => {
        if (themeIcon) {
          themeIcon.className = theme === 'dark' ? 'bi bi-sun text-lg' : 'bi bi-moon-stars text-lg';
        }
      };

      // Initialize icon based on current theme
      updateIcon(htmlEl.getAttribute('data-theme') || 'light');

      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          const currentTheme = htmlEl.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          htmlEl.setAttribute('data-theme', newTheme);
          localStorage.setItem(STORAGE_KEY, newTheme);
          updateIcon(newTheme);
        });
      }
    })();

    document.addEventListener('DOMContentLoaded', () => {
      const firstField = document.querySelector('input[type="text"], input[type="email"]');
      if (firstField) firstField.focus();

      // Real-time password match hint (no noisy alerts)
      const p1 = document.querySelector('input[name="password1"]');
      const p2 = document.querySelector('input[name="password2"]');

      if (p1 && p2) {
        const validate = () => {
          if (p1.value && p2.value && p1.value !== p2.value) {
            p2.setCustomValidity('Passwords do not match');
            p2.classList.add('border-error');
          } else {
            p2.setCustomValidity('');
            p2.classList.remove('border-error');
          }
        };
        p1.addEventListener('input', validate);
        p2.addEventListener('input', validate);
      }

      // Escape to login (handy on desktop)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          window.location.href = "{% url 'account_login' %}";
        }
      });
    });
  </script>
</body>
</html>
