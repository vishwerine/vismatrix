{% extends 'tracker/base.html' %}

{% block title %}Payment History | VisMatrix{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-3xl sm:text-4xl font-black text-base-content mb-2">
        Payment History
      </h1>
      <p class="text-base-content/70">
        View all your past transactions and invoices
      </p>
    </div>
    <a href="{% url 'subscription_plans' %}" class="btn btn-ghost gap-2">
      <i class="bi bi-arrow-left"></i>
      Back to Plans
    </a>
  </div>

  <!-- Payments Table -->
  {% if payments %}
    <div class="card bg-base-100 shadow-xl overflow-x-auto">
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Invoice</th>
          </tr>
        </thead>
        <tbody>
          {% for payment in payments %}
            <tr>
              <td>
                <div class="font-medium">{{ payment.created_at|date:"M d, Y" }}</div>
                <div class="text-sm text-base-content/60">{{ payment.created_at|date:"g:i A" }}</div>
              </td>
              <td>
                <div>{{ payment.description }}</div>
                {% if payment.failure_reason %}
                  <div class="text-sm text-error mt-1">{{ payment.failure_reason }}</div>
                {% endif %}
              </td>
              <td class="font-bold">
                ${{ payment.amount }} {{ payment.currency }}
              </td>
              <td>
                {% if payment.status == 'succeeded' %}
                  <span class="badge badge-success gap-1">
                    <i class="bi bi-check-circle"></i>
                    Paid
                  </span>
                {% elif payment.status == 'pending' %}
                  <span class="badge badge-warning gap-1">
                    <i class="bi bi-clock"></i>
                    Pending
                  </span>
                {% elif payment.status == 'failed' %}
                  <span class="badge badge-error gap-1">
                    <i class="bi bi-x-circle"></i>
                    Failed
                  </span>
                {% elif payment.status == 'refunded' %}
                  <span class="badge badge-info gap-1">
                    <i class="bi bi-arrow-counterclockwise"></i>
                    Refunded
                  </span>
                {% endif %}
              </td>
              <td>
                {% if payment.stripe_invoice_id %}
                  <a href="https://dashboard.stripe.com/invoices/{{ payment.stripe_invoice_id }}" 
                     target="_blank" 
                     class="btn btn-ghost btn-sm gap-1">
                    <i class="bi bi-receipt"></i>
                    View
                  </a>
                {% else %}
                  <span class="text-base-content/40">-</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <!-- Empty State -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body text-center py-20">
        <i class="bi bi-receipt text-6xl text-base-content/30 mb-4"></i>
        <h2 class="text-2xl font-bold mb-2">No payment history</h2>
        <p class="text-base-content/70 mb-6">
          You haven't made any payments yet
        </p>
        <div>
          <a href="{% url 'subscription_plans' %}" class="btn btn-primary gap-2">
            <i class="bi bi-rocket-takeoff"></i>
            Upgrade to Pro
          </a>
        </div>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
