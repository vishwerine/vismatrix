{% extends 'tracker/base.html' %}
{% load widget_tweaks %}

{% block title %}{{ title }} - Progress Tracker{% endblock %}

{% block content %}
<div class="max-w-lg mx-auto bg-white shadow-2xl border border-slate-200 rounded-3xl p-10">
  <div class="text-center mb-12">
    <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl flex items-center justify-center text-white shadow-xl">
      <i class="bi bi-tag-fill text-3xl"></i>
    </div>
    <h1 class="text-4xl font-black text-slate-900 mb-2">{{ title }}</h1>
    <p class="text-xl text-slate-600 max-w-md mx-auto leading-relaxed">
      Create or edit your progress tracking category
    </p>
  </div>

  <form method="post" class="space-y-8">
    {% csrf_token %}
    
    <!-- Category Name -->
    <div class="form-group">
      <label for="id_name" class="block text-sm font-bold text-slate-700 mb-3 tracking-wide uppercase">Category Name</label>
      <div class="relative">
        {{ form.name|add_class:"w-full px-5 py-5 text-lg border-2 border-slate-200 rounded-2xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100/50 focus:outline-none shadow-sm hover:border-slate-300 transition-all duration-200 bg-slate-50 hover:bg-white" }}
        {% if form.name.errors %}
        <div class="mt-2 p-3 bg-red-50 border border-red-200 rounded-xl">
          <ul class="text-red-800 text-sm space-y-1">
            {% for error in form.name.errors %}
            <li><i class="bi bi-exclamation-circle-fill mr-2"></i>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Color Picker -->
    <div class="form-group">
      <label for="id_color" class="block text-sm font-bold text-slate-700 mb-3 tracking-wide uppercase">Category Color</label>
      <div class="relative">
        {{ form.color|add_class:"w-full h-14 px-5 py-3 border-2 border-slate-200 rounded-2xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100/50 focus:outline-none shadow-sm hover:border-slate-300 transition-all duration-200 bg-slate-50 hover:bg-white text-lg font-mono" }}
        {% if form.color.errors %}
        <div class="mt-2 p-3 bg-red-50 border border-red-200 rounded-xl">
          <ul class="text-red-800 text-sm space-y-1">
            {% for error in form.color.errors %}
            <li><i class="bi bi-exclamation-circle-fill mr-2"></i>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Live Preview -->
    <div class="p-8 bg-gradient-to-br from-slate-50 to-slate-100 rounded-3xl border-2 border-slate-200 shadow-inner">
      <div class="flex items-center gap-4 mb-6">
        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg">
          <i class="bi bi-eye text-xl"></i>
        </div>
        <div>
          <h3 class="text-xl font-bold text-slate-900 mb-1">Live Preview</h3>
          <p class="text-sm text-slate-600">See how your category will appear in dashboards</p>
        </div>
      </div>
      <div id="preview" class="inline-flex items-center gap-3 px-8 py-4 rounded-2xl font-bold text-xl shadow-2xl border-4 border-white/50 mx-auto block max-w-md">
        <div class="w-6 h-6 rounded-full ring-2 ring-white/50 shadow-sm flex-shrink-0"></div>
        <span id="preview-text">Category Preview</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 pt-8 border-t-2 border-slate-200">
      <button type="submit"
              class="flex-1 inline-flex items-center justify-center gap-3 bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-8 py-6 rounded-2xl text-xl font-black shadow-2xl hover:shadow-3xl hover:from-blue-700 hover:to-indigo-800 focus:outline-none focus:ring-4 focus:ring-blue-500/50 focus:ring-offset-2 focus:ring-offset-white transform hover:-translate-y-1 transition-all duration-300 active:scale-95">
        <i class="bi bi-check-circle-fill"></i>
        <span>Save Category</span>
      </button>
      
      <a href="{% url 'category_list' %}"
         class="flex-1 inline-flex items-center justify-center gap-3 bg-gradient-to-r from-slate-100 to-slate-200 text-slate-900 px-8 py-6 rounded-2xl text-xl font-black border-2 border-slate-300 hover:border-slate-400 hover:shadow-xl hover:from-slate-200 hover:to-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-500/50 focus:ring-offset-2 focus:ring-offset-white transform hover:-translate-y-1 transition-all duration-300 active:scale-95">
        <i class="bi bi-arrow-left"></i>
        <span>Cancel</span>
      </a>
    </div>
  </form>

  <!-- Tips Section -->
  <div class="mt-12 p-8 bg-gradient-to-r from-emerald-50 to-blue-50 border-2 border-emerald-200 rounded-3xl shadow-lg">
    <div class="flex items-start gap-4 mb-6">
      <div class="w-12 h-12 bg-emerald-500/10 border-2 border-emerald-400 rounded-2xl flex items-center justify-center flex-shrink-0 mt-1">
        <i class="bi bi-lightbulb text-emerald-600 text-xl"></i>
      </div>
      <div>
        <h3 class="text-2xl font-bold text-emerald-900 mb-2">ðŸ’¡ Pro Tips for Categories</h3>
        <p class="text-lg text-emerald-800">Make your tracking more effective</p>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
      <div class="space-y-3 p-4 bg-white/60 backdrop-blur-sm rounded-2xl border border-emerald-100">
        <div class="flex items-start gap-3">
          <div class="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold mt-0.5 flex-shrink-0">1</div>
          <div>
            <p class="font-semibold text-slate-900">Use descriptive names</p>
            <p class="text-slate-700">e.g., "Deep Learning Study", "Morning Exercise", "Code Reviews"</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold mt-0.5 flex-shrink-0">2</div>
          <div>
            <p class="font-semibold text-slate-900">Choose distinct colors</p>
            <p class="text-slate-700">Easy visual identification across dashboards</p>
          </div>
        </div>
      </div>
      
      <div class="space-y-3 p-4 bg-white/60 backdrop-blur-sm rounded-2xl border border-emerald-100">
        <div class="flex items-start gap-3">
          <div class="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold mt-0.5 flex-shrink-0">3</div>
          <div>
            <p class="font-semibold text-slate-900">Keep it manageable</p>
            <p class="text-slate-700">5-10 categories is ideal for most users</p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <div class="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold mt-0.5 flex-shrink-0">4</div>
          <div>
            <p class="font-semibold text-slate-900">Always editable</p>
            <p class="text-slate-700">Rename, recolor, or reorganize anytime</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Enhanced live preview with smooth transitions
  const colorInput = document.getElementById('id_color');
  const preview = document.getElementById('preview');
  const previewText = document.getElementById('preview-text');
  const nameInput = document.getElementById('id_name');

  function updatePreview() {
    const color = colorInput.value || '#3b82f6';
    const name = nameInput.value || 'Category Preview';
    
    // Smooth color transition
    preview.style.background = color;
    preview.style.transition = 'background-color 0.3s ease';
    previewText.textContent = name;
  }

  // Debounced updates for smooth performance
  let timeout;
  function debouncedUpdate() {
    clearTimeout(timeout);
    timeout = setTimeout(updatePreview, 100);
  }

  colorInput.addEventListener('input', debouncedUpdate);
  nameInput.addEventListener('input', debouncedUpdate);

  // Initialize preview
  updatePreview();
</script>

{% endblock %}
