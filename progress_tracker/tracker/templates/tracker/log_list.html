{% extends 'tracker/base.html' %}

{% block title %}Activity Logs - VisMatrix.Space{% endblock %}

{% block content %}
<main class="py-8 sm:py-10">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 space-y-6">

    <!-- Header -->
    <header class="card border border-base-200 bg-base-100 animate-slideUp" role="banner">
      <div class="card-body p-5 sm:p-6">
        <div class="flex items-start justify-between gap-4">
          <div class="min-w-0">
            <h1 class="text-2xl sm:text-3xl font-extrabold text-base-content truncate">
              <span class="gradient-text">Activity logs</span>
            </h1>
            <p class="text-sm text-base-content/70 mt-1">Track your productivity and progress.</p>
          </div>
          <a href="{% url 'log_create' %}" class="btn btn-primary btn-sm gap-2">
            <i class="bi bi-plus-lg" aria-hidden="true"></i>
            <span>New log</span>
          </a>
        </div>
      </div>
    </header>

    <!-- Stats -->
    <section class="grid grid-cols-2 sm:grid-cols-3 gap-4 animate-fadeIn" aria-label="Stats">
      <div class="card border border-base-200 bg-base-100 hover-lift">
        <div class="card-body p-4">
          <p class="text-xs text-base-content/70 font-semibold uppercase tracking-wide">Total logs</p>
          <p class="text-3xl font-extrabold tabular-nums gradient-text">{{ total_logs }}</p>
        </div>
      </div>

      <div class="card border border-base-200 bg-base-100 hover-lift">
        <div class="card-body p-4">
          <p class="text-xs text-base-content/70 font-semibold uppercase tracking-wide">This week</p>
          <p class="text-3xl font-extrabold tabular-nums gradient-text">{{ week_logs }}</p>
        </div>
      </div>

      <div class="card border border-base-200 bg-base-100 hover-lift">
        <div class="card-body p-4">
          <p class="text-xs text-base-content/70 font-semibold uppercase tracking-wide">Total time</p>
          <p class="text-3xl font-extrabold tabular-nums gradient-text">
            {% widthratio total_minutes 60 1 %}h
          </p>
        </div>
      </div>
    </section>

    <!-- Filters -->
    <section class="card border border-base-200 bg-base-100" aria-label="Filters">
      <div class="card-body p-5 sm:p-6">
        <div class="flex flex-col sm:flex-row gap-3 sm:items-end sm:justify-between">
          <form method="GET" class="flex items-end gap-3 w-full sm:w-auto">
            <div class="w-full sm:w-72">
              <label class="label font-semibold">
                <span class="label-text flex items-center gap-2">
                  <i class="bi bi-tag text-primary" aria-hidden="true"></i>
                  Category
                </span>
              </label>
              <select name="category" class="select select-bordered w-full" onchange="this.form.submit()">
                <option value="">All categories</option>
                {% for category in categories %}
                  <option value="{{ category.id }}" {% if category.id == category_id %}selected{% endif %}>
                    {{ category.name }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </form>

          {% if category_id %}
          <a href="{% url 'log_list' %}" class="btn btn-ghost btn-sm gap-2">
            <i class="bi bi-x-circle" aria-hidden="true"></i>
            <span>Clear</span>
          </a>
          {% endif %}
        </div>
      </div>
    </section>

    <!-- Logs table -->
    <section class="card border border-base-200 bg-base-100" aria-label="Logs">
      <div class="card-body p-0">
        {% if page_obj.object_list %}
        <div class="overflow-x-auto">
          <table class="table w-full">
            <thead>
              <tr>
                <th>Activity</th>
                <th class="hidden sm:table-cell">Task</th>
                <th class="hidden sm:table-cell">Category</th>
                <th class="text-right">Duration</th>
                <th class="hidden md:table-cell text-right">Date</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for log in page_obj.object_list %}
              <tr class="hover">
                <td>
                  <div class="min-w-0">
                    <a href="{% url 'log_update' log.id %}" >
                    <p class="font-semibold truncate">{{ log.activity|truncatewords:6 }}</p>
                    </a>
                    {% if log.notes %}
                      <p class="text-xs text-base-content/70 truncate">{{ log.notes|truncatewords:6 }}</p>
                    {% endif %}
                  </div>
                </td>

                <td class="hidden sm:table-cell">
                  {% if log.task %}
                    <span class="badge badge-primary">{{ log.task.title|truncatewords:3 }}</span>
                  {% else %}
                    <span class="text-sm text-base-content/60">‚Äî</span>
                  {% endif %}
                </td>

                <td class="hidden sm:table-cell">
                  {% if log.category %}
                  
                    <span class="badge badge-outline">{{ log.category.name|truncatewords:2 }}</span>
                  
                  {% else %}
                    <span class="text-sm text-base-content/60">‚Äî</span>
                  {% endif %}
                </td>

                <td class="text-right">
                  <span class="badge badge-ghost">{{ log.duration }}m</span>
                </td>

                <td class="hidden md:table-cell text-right text-sm text-base-content/70">
                  {{ log.date|date:"M d, Y" }}
                </td>

                <td class="text-center">
                  <!-- Mobile actions -->
                  <div class="dropdown dropdown-end md:hidden">
                    <button tabindex="0" class="btn btn-ghost btn-sm" aria-label="Row actions">
                      <i class="bi bi-three-dots-vertical" aria-hidden="true"></i>
                    </button>
                    <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-50 shadow-lg border border-base-200 w-40">
                      <li><a href="{% url 'log_update' log.id %}"><i class="bi bi-pencil-square" aria-hidden="true"></i>Edit</a></li>
                      <li><a href="{% url 'log_delete' log.id %}" class="text-error"><i class="bi bi-trash2" aria-hidden="true"></i>Delete</a></li>
                    </ul>
                  </div>

                  <!-- Desktop actions -->
                  <div class="hidden md:flex justify-center gap-2">
                    <a href="{% url 'log_update' log.id %}" class="btn btn-outline btn-sm" aria-label="Edit log">
                      <i class="bi bi-pencil-square" aria-hidden="true"></i>
                    </a>
                    <a href="{% url 'log_delete' log.id %}" class="btn btn-outline btn-sm text-error" aria-label="Delete log">
                      <i class="bi bi-trash2" aria-hidden="true"></i>
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        {% if is_paginated %}
        <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between p-5 border-t border-base-200">
          <p class="text-sm text-base-content/70">
            Page <span class="font-semibold">{{ page_obj.number }}</span> of <span class="font-semibold">{{ page_obj.paginator.num_pages }}</span>
          </p>

          <div class="join">
            {% if page_obj.has_previous %}
              <a href="?page=1" class="btn btn-outline btn-sm join-item" aria-label="First page">
                <i class="bi bi-chevron-double-left" aria-hidden="true"></i>
              </a>
              <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline btn-sm join-item" aria-label="Previous page">
                <i class="bi bi-chevron-left" aria-hidden="true"></i>
                <span class="hidden sm:inline">Prev</span>
              </a>
            {% endif %}

            {% if page_obj.has_next %}
              <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline btn-sm join-item" aria-label="Next page">
                <span class="hidden sm:inline">Next</span>
                <i class="bi bi-chevron-right" aria-hidden="true"></i>
              </a>
              <a href="?page={{ page_obj.paginator.num_pages }}" class="btn btn-outline btn-sm join-item" aria-label="Last page">
                <i class="bi bi-chevron-double-right" aria-hidden="true"></i>
              </a>
            {% endif %}
          </div>
        </div>
        {% endif %}

        {% else %}
        <div class="p-8 sm:p-10 text-center">
          <div class="text-4xl mb-3">üìù</div>
          <h2 class="text-lg font-bold">No logs yet</h2>
          <p class="text-sm text-base-content/70 mt-1">Start logging your activities to track progress.</p>
          <a href="{% url 'log_create' %}" class="btn btn-primary btn-sm mt-4">Log activity</a>
        </div>
        {% endif %}
      </div>
    </section>

    <!-- Mobile quick nav (optional; base.html already has one, remove if duplicated) -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-base-100 border-t border-base-200 z-40">
      <div class="grid grid-cols-4 h-16 text-xs">
        <a href="{% url 'log_create' %}" class="flex flex-col items-center justify-center gap-1 hover:bg-base-200/40">
          <i class="bi bi-plus-circle text-xl text-primary" aria-hidden="true"></i>
          <span>New</span>
        </a>
        <a href="{% url 'task_list' %}" class="flex flex-col items-center justify-center gap-1 hover:bg-base-200/40">
          <i class="bi bi-list-check text-xl" aria-hidden="true"></i>
          <span>Tasks</span>
        </a>
        <a href="{% url 'log_list' %}" class="flex flex-col items-center justify-center gap-1 bg-base-200/40">
          <i class="bi bi-journal-text text-xl text-primary" aria-hidden="true"></i>
          <span>Logs</span>
        </a>
        <a href="{% url 'dashboard' %}" class="flex flex-col items-center justify-center gap-1 hover:bg-base-200/40">
          <i class="bi bi-house text-xl" aria-hidden="true"></i>
          <span>Home</span>
        </a>
      </div>
    </nav>

  </div>
</main>
{% endblock %}
