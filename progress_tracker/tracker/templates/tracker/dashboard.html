{% extends 'tracker/base.html' %}

{% block title %}Dashboard - VisMatrix.Space{% endblock %}

{% block content %}
<div class="grid grid-cols-1 gap-6 md:grid-cols-3">
    <!-- Quick Stats -->
    <div class="stats shadow">
        <div class="stat">
            <div class="stat-title">Tasks Today</div>
            <div class="stat-value text-primary">{{ today_tasks_count|default:0 }}</div>
            <div class="stat-desc">{% if completed_today %}{{ completed_today }} completed{% else %}None completed{% endif %}</div>
        </div>
    </div>
    
    <div class="stats shadow">
        <div class="stat">
            <div class="stat-title">Active Streak</div>
            <div class="stat-value text-secondary">{{ current_streak|default:0 }}</div>
            <div class="stat-desc">days</div>
        </div>
    </div>
    
    <div class="stats shadow">
        <div class="stat">
            <div class="stat-title">This Month</div>
            <div class="stat-value text-accent">{{ logs_this_month|default:0 }}</div>
            <div class="stat-desc">progress entries</div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 gap-6 lg:grid-cols-3 mt-8">
    <!-- Pending Tasks -->
    <div class="lg:col-span-2">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title flex items-center gap-2">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                    Today's Tasks
                </h2>
                
                {% if pending_tasks %}
                <div class="space-y-3 mt-4">
                    {% for task in pending_tasks %}
                    <div class="flex items-center justify-between p-3 bg-base-200 rounded-lg hover:bg-base-300 transition">
                        <div class="flex-1 min-w-0">
                            <h3 class="font-semibold text-sm md:text-base truncate">{{ task.title }}</h3>
                            <p class="text-xs md:text-sm opacity-75">{{ task.category.name }}</p>
                        </div>
                        <div class="flex gap-2 ml-2 flex-shrink-0">
                            <a href="{% url 'log_create' %}?task={{ task.id }}" class="btn btn-primary btn-sm">Log</a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <div class="text-4xl mb-2">ðŸŽ‰</div>
                    <p class="text-lg font-semibold">No pending tasks</p>
                    <p class="opacity-75 text-sm">You're all caught up for today!</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Friends Sidebar -->
    <div class="space-y-6">
        <!-- Friend Requests -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-lg">Friend Requests</h2>
                {% if pending_friend_requests %}
                <div class="space-y-2">
                    {% for request in pending_friend_requests|slice:":3" %}
                    <div class="flex items-center justify-between p-2 bg-base-200 rounded">
                        <span class="text-sm font-medium truncate">{{ request.from_user.username }}</span>
                        <div class="flex gap-1 flex-shrink-0">
                            <button class="btn btn-xs btn-primary">Accept</button>
                            <button class="btn btn-xs btn-outline">Decline</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <a href="{% url 'friend_requests' %}" class="link link-primary text-sm mt-2">View all</a>
                {% else %}
                <p class="text-sm opacity-75">No pending requests</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-lg">Quick Actions</h2>
                <div class="flex flex-col gap-2">
                    <a href="{% url 'task_create' %}" class="btn btn-primary btn-sm">+ New Task</a>
                    <a href="{% url 'log_create' %}" class="btn btn-secondary btn-sm">+ Log Progress</a>
                    <a href="{% url 'friends_list' %}" class="btn btn-outline btn-sm">Find Friends</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card bg-base-100 shadow-xl mt-8">
    <div class="card-body">
        <h2 class="card-title flex items-center gap-2">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            Recent Activity
        </h2>
        
        {% if recent_logs %}
        <div class="overflow-x-auto mt-4">
            <table class="table w-full text-sm">
                <tbody>
                    {% for log in recent_logs|slice:":5" %}
                    <tr class="hover">
                        <td>
                            <div>
                                <div class="font-semibold text-sm md:text-base">{{ log.activity }}</div>
                                <div class="text-xs opacity-75">{{ log.category.name }}</div>
                            </div>
                        </td>
                        <td class="text-right">
                            <span class="badge">{{ log.duration }}m</span>
                        </td>
                        <td class="text-right text-xs opacity-75">{{ log.date|date:"M d" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <a href="{% url 'log_list' %}" class="link link-primary text-sm mt-4">View all activity</a>
        {% else %}
        <div class="text-center py-8">
            <p class="text-lg font-semibold">No activity yet</p>
            <p class="opacity-75 text-sm">Start tracking to see your progress</p>
            <a href="{% url 'log_create' %}" class="btn btn-primary btn-sm mt-4">Log your first entry</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}