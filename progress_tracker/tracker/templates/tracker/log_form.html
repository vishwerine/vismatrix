{% extends 'tracker/base.html' %}
{% load widget_tweaks %}

{% block title %}{{ title|default:"Log Activity" }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-emerald-50 to-teal-50 py-12 px-4 sm:px-6 lg:px-8">
  <!-- Decorative background elements -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-r from-emerald-200/30 to-teal-200/30 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-l from-teal-200/30 to-blue-200/30 rounded-full blur-3xl animate-pulse delay-1000"></div>
  </div>

  <div class="relative z-10 max-w-2xl mx-auto">
    <!-- Header with progress indicator -->
    <div class="text-center mb-12 lg:mb-16">
      <div class="inline-flex items-center gap-3 bg-white/80 backdrop-blur-xl px-6 py-3 rounded-3xl shadow-xl border border-emerald-200/50 mb-6">
        <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-lg">
          <i class="bi bi-journal-check text-2xl text-white"></i>
        </div>
        <div>
          <h1 class="text-3xl lg:text-4xl font-black bg-gradient-to-r from-slate-900 via-slate-800 to-emerald-900 bg-clip-text text-transparent">
            {{ title|default:"Log Activity" }}
          </h1>
          <p class="text-emerald-700 font-semibold text-sm uppercase tracking-wider">Track your productivity</p>
        </div>
      </div>
      
      <!-- Quick stats preview -->
      <div class="grid grid-cols-2 md:grid-cols-3 gap-3 max-w-md mx-auto mb-8">
        <div class="bg-white/70 backdrop-blur-xl p-4 rounded-2xl shadow-lg border border-slate-200/50 text-center">
          <div class="text-2xl font-bold text-emerald-600">{{ today_logs|default:0 }}</div>
          <div class="text-xs text-slate-600 uppercase tracking-wider">Today</div>
        </div>
        <div class="bg-white/70 backdrop-blur-xl p-4 rounded-2xl shadow-lg border border-slate-200/50 text-center">
          <div class="text-2xl font-bold text-teal-600">{{ week_total|default:0 }}</div>
          <div class="text-xs text-slate-600 uppercase tracking-wider">This Week</div>
        </div>
        <div class="bg-white/70 backdrop-blur-xl p-4 rounded-2xl shadow-lg border border-slate-200/50 text-center">
          <span class="text-sm font-bold text-slate-800 px-3 py-1 bg-gradient-to-r from-emerald-100 to-teal-100 rounded-full">
            {{ form.instance.id|default:"New" }}
          </span>
          <div class="text-xs text-slate-600 mt-1">Status</div>
        </div>
      </div>
    </div>

    <!-- Main form card -->
    <div class="bg-white/95 backdrop-blur-2xl shadow-2xl border border-slate-200/50 rounded-3xl overflow-hidden animate-slideUp">
      <div class="p-6 lg:p-10">
        <!-- Messages with better styling -->
        {% if messages %}
        <div class="mb-8 space-y-3">
          {% for message in messages %}
          <div class="flex items-start gap-3 p-5 rounded-2xl shadow-lg transform transition-all hover:scale-[1.02] {% if message.tags == 'success' %}bg-gradient-to-r from-emerald-50 to-teal-50 border-4 border-emerald-200{% elif message.tags == 'error' %}bg-gradient-to-r from-red-50 to-rose-50 border-4 border-red-200{% else %}bg-gradient-to-r from-blue-50 to-indigo-50 border-4 border-blue-200{% endif %}">
            <div class="flex-shrink-0 mt-0.5">
              {% if message.tags == 'success' %}
                <i class="bi bi-check-circle-fill text-2xl text-emerald-500"></i>
              {% elif message.tags == 'error' %}
                <i class="bi bi-exclamation-triangle-fill text-2xl text-red-500"></i>
              {% else %}
                <i class="bi bi-info-circle-fill text-2xl text-blue-500"></i>
              {% endif %}
            </div>
            <div class="flex-1">
              <p class="font-semibold text-lg {% if message.tags == 'success' %}text-emerald-900{% elif message.tags == 'error' %}text-red-900{% else %}text-slate-900{% endif %}">
                {{ message }}
              </p>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <!-- Form with improved layout -->
        <form method="post" novalidate class="space-y-7">
          {% csrf_token %}
          
          <!-- Activity - Hero field -->
          <div class="relative">
            <label for="{{ form.activity.id_for_label }}" class="block text-xl font-black text-slate-900 mb-4 bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent">
              What did you work on? <span class="text-emerald-600">*</span>
            </label>
            <div class="relative">
              {% render_field form.activity class="w-full px-6 py-6 lg:py-8 border-2 border-slate-200 rounded-3xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-200/75 bg-gradient-to-b from-white to-slate-50/50 min-h-[140px] lg:min-h-[160px] resize-vertical shadow-inner" placeholder="examples Read Book, worked out etc" %}
              <div class="absolute top-4 left-4 text-emerald-400 text-xl opacity-75 pointer-events-none">
                <i class="bi bi-journal-text"></i>
              </div>
            </div>
            {% if form.activity.errors %}
            <div class="mt-3 p-4 bg-red-50 border border-red-200 rounded-2xl flex items-center gap-3">
              <i class="bi bi-exclamation-circle-fill text-red-500 text-xl flex-shrink-0"></i>
              <span class="text-sm font-medium text-red-900">{{ form.activity.errors|first }}</span>
            </div>
            {% endif %}
          </div>

          <!-- Grid layout for remaining fields -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-7">
            <!-- Date & Duration -->
            <div class="space-y-5">
              <div>
                <label for="{{ form.date.id_for_label }}" class="block text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
                  <i class="bi bi-calendar3 text-emerald-500"></i>
                  Date
                </label>
                {% render_field form.date class="w-full px-6 py-5 border-2 border-slate-200 rounded-2xl focus:border-blue-500 focus:ring-4 focus:ring-blue-200/75 shadow-sm" %}
              </div>
              
              <div>
                <label for="{{ form.duration.id_for_label }}" class="block text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
                  <i class="bi bi-stopwatch text-orange-500"></i>
                  Duration
                </label>
                <div class="relative">
                  {% render_field form.duration class="w-full pr-24 py-5 border-2 border-slate-200 rounded-2xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200/75 shadow-sm" min="1" max="1440" placeholder="60" %}
                  <div class="absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-1 text-slate-500 font-mono text-lg bg-white/80 px-2 py-1 rounded-xl">
                    <i class="bi bi-clock"></i>
                    min
                  </div>
                </div>
              </div>
            </div>

            <!-- Category & Notes -->
            <div class="space-y-5">
              <div>
                <label for="{{ form.category.id_for_label }}" class="block text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
                  <i class="bi bi-tag text-purple-500"></i>
                  Category
                </label>
                <div class="relative">
                  {% render_field form.category class="w-full px-6 py-5 pr-12 border-2 border-slate-200 rounded-2xl focus:border-purple-500 focus:ring-4 focus:ring-purple-200/75 shadow-sm" %}
                  <div class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500">
                    <i class="bi bi-chevron-down text-lg"></i>
                  </div>
                </div>
              </div>
              
              <div>
                <label for="{{ form.description.id_for_label }}" class="block text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
                  <i class="bi bi-chat-square-text text-indigo-500"></i>
                  Notes (optional)
                </label>
                {% render_field form.description class="w-full px-6 py-5 border-2 border-slate-200 rounded-2xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-200/75 resize-vertical shadow-sm" rows="3" placeholder="Any additional details, feelings, or insights..." %}
              </div>
            </div>
          </div>

          <!-- Enhanced action buttons -->
          <div class="pt-10 border-t-4 border-gradient-to-r from-emerald-200 via-teal-200 to-emerald-200 border-opacity-75">
            <div class="flex flex-col lg:flex-row gap-4 items-stretch lg:items-center">
              <!-- Primary action -->
              <button type="submit" 
                      class="group flex-1 lg:flex-none bg-gradient-to-r from-emerald-600 via-teal-600 to-emerald-700 hover:from-emerald-700 hover:via-teal-700 hover:to-emerald-800 text-white font-black py-6 px-10 rounded-3xl shadow-2xl hover:shadow-3xl focus:ring-4 focus:ring-emerald-500/50 transform hover:-translate-y-1 transition-all duration-300 text-lg flex items-center justify-center gap-3 border-0">
                <i class="bi bi-check-lg group-hover:scale-110 transition-transform text-xl"></i>
                <span>Save Activity Log</span>
                <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/20 via-transparent to-teal-500/20 -inset-1 rounded-3xl blur opacity-0 group-hover:opacity-100 transition-opacity"></div>
              </button>
              
              <!-- Secondary actions -->
              <div class="flex flex-col sm:flex-row gap-3 flex-1 lg:flex-none">
                <a href="{% url 'log_list' %}" 
                   class="flex-1 bg-gradient-to-r from-slate-100 to-slate-200 hover:from-slate-200 hover:to-slate-300 text-slate-800 font-semibold py-5 px-8 rounded-2xl shadow-xl hover:shadow-2xl focus:ring-4 focus:ring-slate-400/50 transition-all duration-300 flex items-center justify-center gap-2 border border-slate-300/50">
                  <i class="bi bi-list-ul text-lg"></i>
                  View All Logs
                </a>
                <a href="{% url 'dashboard' %}" 
                   class="flex-1 bg-white border-2 border-slate-300 hover:border-slate-400 text-slate-900 hover:text-slate-800 font-semibold py-5 px-8 rounded-2xl shadow-lg hover:shadow-xl focus:ring-4 focus:ring-slate-400/50 transition-all duration-300 flex items-center justify-center gap-2">
                  <i class="bi bi-arrow-left text-lg"></i>
                  Back to Dashboard
                </a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Quick tips -->
    <div class="mt-12 text-center text-sm text-slate-600 max-w-lg mx-auto space-y-2">
      <p><i class="bi bi-lightbulb text-amber-500 mr-1"></i>Pro tip: Use categories to analyze your productivity patterns</p>
      <p><i class="bi bi-clock-history text-blue-500 mr-1"></i>Track even short sessions â€” consistency compounds!</p>
    </div>
  </div>
</div>

<style>
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-slideUp {
    animation: slideUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  @media (prefers-reduced-motion: reduce) {
    .animate-slideUp { animation: none; }
  }
</style>
{% endblock %}
